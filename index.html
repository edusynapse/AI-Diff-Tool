<!DOCTYPE html>
<html lang="en">
<head>
  <!-- History modal added (View ‚Üí History‚Ä¶) -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta http-equiv="Content-Security-Policy"
  content="
    default-src 'self';
    img-src 'self' data: file: https://*.razorpay.com https://razorpay.com;
    style-src 'self' 'unsafe-inline' https://cdn.razorpay.com https://*.razorpay.com;
    style-src-elem 'self' 'unsafe-inline' https://cdn.razorpay.com https://*.razorpay.com;
    script-src 'self' 'unsafe-eval' https://checkout.razorpay.com https://cdn.razorpay.com https://browser.sentry-cdn.com;
    script-src-elem 'self' 'unsafe-eval' https://checkout.razorpay.com https://cdn.razorpay.com https://browser.sentry-cdn.com;
    connect-src 'self' https://*.razorpay.com https://razorpay.com https://*.sentry.io https://api.github.com;
    frame-src 'self' https://*.razorpay.com https://razorpay.com http://127.0.0.1:* http://localhost:*;
    form-action 'self' https://*.razorpay.com https://razorpay.com;
  ">

  
  <title>AI Diff Tool - Grok 4 Patch Applier</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="node_modules/diff2html/bundles/css/diff2html.min.css">
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar" aria-label="Workspaces">
  <!-- Fixed topbar -->
  <div class="sidebar-topbar">
    <div class="sidebar-title" id="sidebarWorkspacesTitle">Workspaces</div>
    <button
      id="newTabBtn"
      class="topbar-btn topbar-btn--sidebar"
      type="button"
      title="New tab"
      aria-label="New tab"
    >+</button>
  </div>

  <!-- Scrollable area -->
  <div class="sidebar-scroll">
    <div id="tabsList" class="tabs-list" role="tablist" aria-orientation="vertical"></div>

    <div class="sidebar-footer">
      <div class="sidebar-hint" id="sidebarRenameHint">Double-click a tab to rename</div>
    </div>
  </div>
</aside>

    <main class="main">
  <!-- Fixed topbar (same height as sidebar topbar) -->
  <div class="main-topbar">
  <div class="main-brand">
    <img
      id="appIconImg"
      class="app-icon hidden"
      src=""
      alt="AI Diff Tool icon"
    />
    <div class="main-title" id="mainAppTitle">AI Diff Tool</div>
  </div>
 
  <div class="main-topbar-actions">

    <button id="copyOutputTopBtn" class="topbar-btn topbar-btn--nav with-icon hidden" type="button" title="Copy Output" aria-label="Copy Output">
      <span class="btn-ico" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M8 8h12v12H8z"/><path d="M4 4h12v12"/></svg></span><span class="btn-label">Copy Output</span>
    </button>
    <button id="diffPrevBtn" class="topbar-btn topbar-btn--nav with-icon hidden" type="button" title="Previous change">
      <span class="btn-ico" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg></span><span class="btn-label">Prev change</span>
    </button>
    <button id="diffNextBtn" class="topbar-btn topbar-btn--nav with-icon hidden" type="button" title="Next change">
      <span class="btn-ico" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg></span><span class="btn-label">Next change</span>
    </button>

    <!-- Appears only when the diff section is below the viewport (and output exists) -->
    <button id="goOutputDiffBtn" class="topbar-btn topbar-btn--main with-icon hidden" type="button" title="Output Diff" aria-label="Output Diff">
      <span class="btn-ico" aria-hidden="true"><svg viewBox="0 0 24 24"><rect x="4" y="5" width="7" height="14" rx="1.5"/><rect x="13" y="5" width="7" height="14" rx="1.5"/><path d="M11 12h2"/></svg></span><span class="btn-label">Output Diff</span>
    </button>
    <!-- Appears only after scrolling down -->
    <button id="goTopBtn" class="topbar-btn topbar-btn--main with-icon hidden" type="button">
      <span class="btn-ico" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M12 19V5"/><path d="M6 11l6-6 6 6"/></svg></span><span class="btn-label">Go to top</span>
    </button>
  </div>
</div>

  <!-- Scrollable body -->
  <div id="mainScroll" class="main-body">
    <!-- REMOVE the old <h1> entirely (per your request) -->

    <!-- Model selector + Apply button row (per-tab state handled in renderer.js) -->
    <div class="model-action-row">
      <div class="model-action-left">
        <label for="modelSelect" class="inline-label" id="modelSelectLabel">Select Model:</label>
        <select id="modelSelect">
          <optgroup label="xAI" data-provider="xai">
            <option value="grok-4-1-fast-reasoning">grok-4-1-fast-reasoning</option>
            <option value="grok-4-1-fast-non-reasoning">grok-4-1-fast-non-reasoning</option>
            <option value="grok-code-fast-1">grok-code-fast-1</option>
            <option value="grok-4-fast-reasoning">grok-4-fast-reasoning</option>
            <option value="grok-4-fast-non-reasoning">grok-4-fast-non-reasoning</option>
          </optgroup>
          <optgroup label="OpenAI" data-provider="openai">
            <option value="gpt-4.1-mini">gpt-4.1-mini</option>
            <option value="gpt-4.1-nano">gpt-4.1-nano</option>
            <option value="gpt-5.2-mini">gpt-5.2-mini</option>
            <option value="gpt-5.2-nano">gpt-5.2-nano</option>
          </optgroup>
        </select>
      </div>
      <div class="model-action-right">
        <button id="retryBtn" class="hidden" type="button">Retry</button>
        <button id="sysPromptBtn" type="button" title="System prompt">Default</button>
        <button id="applyBtn" type="button">Apply Patch</button>
      </div>
    </div>

    <div id="loading" class="hidden"><div class="spinner"></div> <span id="loadingText">Processing...</span></div>

    <label for="diff" id="diffLabel">Diff Patch (paste or load file):</label>
    <div class="file-picker" id="diffFilePicker" aria-label="Diff patch file picker" style="margin: 6px 0 10px;">
      <button id="diffFileBtn" class="modal-ok" type="button">Choose file</button>
      <span id="diffFileName" class="file-name">No file chosen</span>
      <!-- keep the real input for the OS picker, but hide it (we localize our own UI) -->
      <input type="file" id="diffFile" class="hidden">
    </div>
    <div  id="diff-container"  class="ta-container">
      <div class="ta-actions" aria-label="Diff textarea actions">
        <button type="button" class="ta-fab" data-ta-action="max" data-ta-target="#diff" title="Maximize" aria-label="Maximize">‚õ∂</button>
        <button type="button" class="ta-fab" data-ta-action="min" data-ta-target="#diff" title="Minimize" aria-label="Minimize">üóï</button>
      </div>
      <textarea id="diff" rows="10"></textarea>
    </div>
    <div aria-hidden="true" style="height: 22px;"></div>

    <label for="model" id="modelLabel">File Content (paste or load file):</label>
    <div class="file-picker" id="modelFilePicker" aria-label="File content file picker" style="margin: 6px 0 10px;">
      <button id="modelFileBtn" class="modal-ok" type="button">Choose file</button>
      <span id="modelFileName" class="file-name">No file chosen</span>
      <!-- keep the real input for the OS picker, but hide it (we localize our own UI) -->
      <input type="file" id="modelFile" class="hidden">
    </div>
    <div  id="model-container"  class="ta-container">
      <div class="ta-actions" aria-label="File content textarea actions">
        <button type="button" class="ta-fab" data-ta-action="max" data-ta-target="#model" title="Maximize" aria-label="Maximize">‚õ∂</button>
        <button type="button" class="ta-fab" data-ta-action="min" data-ta-target="#model" title="Minimize" aria-label="Minimize">üóï</button>
      </div>
      <textarea id="model" rows="15"></textarea>
    </div>
    <div aria-hidden="true" style="height: 22px;"></div>

    <div class="section-row" aria-label="Output header row">
      <div class="section-title" id="outputSectionTitle">Output from Model</div>
      <div id="modelTime" class="section-meta hidden" aria-label="Time taken by model to reply"></div>
    </div>
    <div id="output-container" class="ta-container">
      <div class="ta-actions" aria-label="Output actions">
        <button type="button" class="ta-fab" data-ta-action="max" data-ta-target="#output" title="Maximize" aria-label="Maximize">‚õ∂</button>
        <button type="button" class="ta-fab" data-ta-action="min" data-ta-target="#output" title="Minimize" aria-label="Minimize">üóï</button>
        <!-- In output: max/min MUST precede Copy -->
        <button id="copyBtn" class="ta-copy hidden" type="button">Copy</button>
      </div>
      <pre id="output"></pre>
    </div>

    <button id="download" class="hidden">Download Modified File</button>

    <div class="section-row" aria-label="Diff header row">
      <div class="section-title" id="diffSectionTitle">Diff with original</div>
    </div>
    <div id="diffView"></div>
    <div id="error"></div>
  </div>
</main>
  </div>

  <!-- About overlay (opened from Help ‚Üí About‚Ä¶) -->
  <div id="aboutOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <div class="modal-content  modal-about" role="document">
      <div class="modal-header">
        <h2 id="aboutTitle">About</h2>
        <button id="aboutCloseBtn" class="modal-close" aria-label="Close about">√ó</button>
      </div>

      <div class="modal-body">
        <div class="about-thanks" id="aboutThanks">Thank you for using</div>

        <div class="about-app-name" id="aboutAppName">AI Diff Tool</div>

        <!-- Place the creator image inside the app bundle. Recommended path: build/creator.png -->
        <img
        id="aboutCreatorImg"
        class="about-image"
        src=""
        alt="Creator"
        />


        <div class="about-meta">
          <div class="about-row">
            <div class="about-label" id="aboutCreatorLabel">Creator</div>
            <div class="about-value" id="aboutCreatorName"></div>
          </div>

          <div class="about-row">
            <div class="about-label" id="aboutEmailLabel">Email</div>
            <div class="about-value">
              <a id="aboutCreatorEmail" href="#" rel="noreferrer"></a>
            </div>
          </div>
        </div>

        <div class="about-actions">
          <button id="aboutGitHubBtn" class="modal-ok" type="button">GitHub Repo</button>
        </div>

        <!-- Razorpay payment button (sandboxed iframe) -->
        <div class="about-razorpay" aria-label="Donate with Razorpay">
          <div class="about-license-title" id="aboutRazorpayTitle">Donate (Razorpay)</div>
          <iframe
            id="aboutRazorpayFrame"
            class="about-razorpay-frame"
            title="Razorpay payment button"
            sandbox="allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-top-navigation-by-user-activation"
            referrerpolicy="no-referrer"
            style="width: 100%; height: 92px; border: 0; overflow: hidden;"
          ></iframe>
        </div>

        <div class="about-footer">
          <div class="about-license">
            <div class="about-license-title" id="aboutLicenseTitle">Open Source License</div>
            <div class="about-license-text" id="aboutLicenseText">
              This project is open-source. See the LICENSE file in the GitHub repository.
            </div>
          </div>

          <div class="about-version">
            <span id="aboutVersionPrefix">Version</span> <span id="aboutVersion"></span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="aboutOkBtn" class="modal-ok">Close</button>
      </div>
    </div>
  </div>

  <!-- Help overlay (opened from Help menu) -->
  <div id="helpOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="helpTitle">AI Diff Tool ‚Äî Usage</h2>
        <button id="helpCloseBtn" class="modal-close" aria-label="Close help">√ó</button>
      </div>

      <div class="modal-body" id="helpBody">
        <p>
          This app applies a <b>unified diff patch</b> to a file by asking the selected model (xAI Grok or OpenAI GPT) to produce the patched output.
           It then shows you the modified file and a side-by-side diff view.
         </p>

         <h3>Quick steps</h3>
         <ol>
           <li><b>Pick a workspace tab</b> (left sidebar). Each tab keeps its own inputs, model, prompt, output, and diff.</li>
           <li><b>Select Model</b> (top dropdown).</li>
           <li><b>Choose System Prompt</b> (top button: <b>Prompt - ...</b>) if you need stricter/looser behavior.</li>
           <li><b>Paste or load</b> your unified diff patch into <b>Diff Patch</b> (use ‚ÄúChoose file‚Äù under the textarea if you prefer).</li>
           <li><b>Paste or load</b> the original file content into <b>File Content</b> (use ‚ÄúChoose file‚Äù under the textarea if you prefer).</li>
           <li>Enter your <b>API Key</b> (xAI for <code>grok-*</code>, OpenAI for <code>gpt-*</code>) and <b>6-digit PIN</b>, then <b>Save</b> (stored locally, encrypted).</li>
           <li>Click <b>Apply Patch</b>. Review the output and the ‚ÄúDiff with original‚Äù.</li>
           <li>Use <b>Copy</b> or <b>Download Modified File</b> once output is generated.</li>
         </ol>

         <h3>Workspaces (tabs)</h3>
         <ul>
           <li>Create a new tab with the <b>+</b> button (or <b>Cmd/Ctrl + T</b>).</li>
           <li><b>Double-click</b> a tab to rename it.</li>
           <li>Close a tab with the <b>√ó</b> on the tab (or <b>Cmd/Ctrl + W</b>).</li>
           <li>Cycle tabs with <b>Cmd/Ctrl + Tab</b> (and <b>Cmd/Ctrl + Shift + Tab</b>).</li>
         </ul>

         <h3>System Prompt</h3>
         <ul>
           <li>Open via the top <b>Prompt - ...</b> button, or <b>Edit ‚Üí System Prompt‚Ä¶</b> (<b>Cmd/Ctrl + Shift + P</b>).</li>
           <li><b>Default</b> is locked. Use <b>New</b> or <b>Duplicate</b> to create a custom prompt.</li>
           <li>Click <b>Use in this tab</b> to apply the selected prompt to the current workspace.</li>
           <li>Prompts are stored locally (in this app's localStorage).</li>
         </ul>

         <h3>API keys (xAI / OpenAI)</h3>
         <ul>
           <li>Open via <b>File ‚Üí xAI API Key‚Ä¶</b> (<b>Cmd/Ctrl + K</b>) or <b>File ‚Üí OpenAI API Key‚Ä¶</b> (<b>Cmd/Ctrl + Shift + K</b>).</li>
           <li>Keys are encrypted locally using your <b>6-digit PIN</b>. The PIN is not stored; you unlock keys once per app session.</li>
           <li>The app automatically chooses which provider key to use based on the model name (<code>grok-*</code> vs <code>gpt-*</code>).</li>
         </ul>

         <h3>Output, diff navigation, and tools</h3>
         <ul>
           <li>The model is instructed to output <b>only the final file contents</b> (no code fences, no commentary).</li>
           <li>If the file is large, you may get a size warning before sending.</li>
           <li>The top-right metadata shows <b>time</b> and an <b>estimated token count</b> as: <code>&lt;time&gt; / &lt;tokens&gt;</code>.</li>
           <li><b>Prev change</b> / <b>Next change</b> buttons appear when the diff section is on-screen.</li>
           <li><b>Go to top</b> appears after you scroll down.</li>
           <li>Use the <b>‚õ∂</b>/<b>üóï</b> buttons to expand/collapse Diff, File Content, and Output.</li>
           <li><b>Retry</b> appears when a request fails and retries are available.</li>
           <li><b>Dark Mode</b> can be toggled via the <b>View ‚Üí Dark Mode</b> menu item (or <b>Cmd/Ctrl + D</b>).</li>
           <li>You can dismiss this help with <b>ESC</b>, the <b>√ó</b> button, or by clicking the background.</li>
         </ul>

         <h3>Keyboard shortcuts</h3>
         <ul>
           <li><b>F1</b>: Open Usage Help</li>
           <li><b>Cmd/Ctrl + D</b>: Toggle Dark Mode</li>
           <li><b>Cmd/Ctrl + K</b>: xAI API Key</li>
           <li><b>Cmd/Ctrl + Shift + K</b>: OpenAI API Key</li>
           <li><b>Cmd/Ctrl + Shift + P</b>: System Prompt</li>
           <li><b>Cmd/Ctrl + T</b>: New tab</li>
           <li><b>Cmd/Ctrl + W</b>: Close tab</li>
           <li><b>Cmd/Ctrl + Tab</b>: Next tab</li>
           <li><b>Cmd/Ctrl + Shift + Tab</b>: Previous tab</li>
           <li><b>F7</b>: Previous change</li>
           <li><b>F8</b>: Next change</li>
           <li><b>ESC</b>: Close the currently open dialog</li>
         </ul>
       </div>

      <div class="modal-footer">
        <button id="helpOkBtn" class="modal-ok">Close</button>
      </div>
    </div>
  </div>
  <!-- Key Type overlay (shown ONLY when no keys exist at all) -->
  <div id="keyTypeOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="keyTypeTitle">
    <div class="modal-content modal-sm" role="document">
      <div class="modal-header">
        <h2 id="keyTypeTitle">Choose API Key Type</h2>
      </div>

      <div class="modal-body">
        <p id="keyTypeIntro">
          No API keys are saved yet. Choose which provider you want to configure first.
          You'll set a <b>6-digit PIN</b> once, and it will be used to encrypt/decrypt keys locally.
        </p>
        <div id="keyTypeHint" class="modal-hint"></div>
      </div>

      <div class="modal-footer" style="justify-content: space-between;">
        <button id="keyTypeXaiBtn" class="modal-ok" type="button">xAI</button>
        <button id="keyTypeOpenAiBtn" class="modal-ok" type="button">OpenAI</button>
      </div>
    </div>
  </div>

  <!-- API Key overlay (opened from menu, or when required) -->
  <div id="apiKeyOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="apiKeyTitle">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="apiKeyTitle">API Key</h2>
        <button id="apiKeyCloseBtn" class="modal-close" aria-label="Close API key dialog">√ó</button>
      </div>

      <div class="modal-body">
        <p id="apiKeyModalIntro">
          Enter your <b>API Key</b> and a <b>6-digit PIN</b>. The key is encrypted locally and stored in this app (localStorage).
          The PIN is not stored ‚Äî you'll be asked for it on app launch to unlock saved keys.
        </p>

        <label id="apiKeyModalLabel" for="apiKeyModalInput">API Key</label>
        <div id="apiKeyInputRow" class="api-key-row">
          <input type="password" id="apiKeyModalInput" placeholder="sk-..." autocomplete="off">
          <!-- Same-row Update/Save (state toggled in renderer.js) -->
          <button id="apiKeyEditBtn" class="modal-ok" type="button">Save</button>
        </div>

        <label id="apiKeyPinLabel">6-digit PIN</label>
        <div id="apiKeyPinBoxes" class="pin-boxes" role="group" aria-labelledby="apiKeyPinLabel">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="PIN digit 1" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="PIN digit 2" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="PIN digit 3" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="PIN digit 4" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="PIN digit 5" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="PIN digit 6" autocomplete="one-time-code">
        </div>
        <!-- hidden aggregator (JS keeps this in sync with the 6 boxes) -->
        <input type="hidden" id="apiKeyPinInput" inputmode="numeric" maxlength="6" autocomplete="off">

        <div id="apiKeyModalHint" class="modal-hint"></div>
      </div>

      <div class="modal-footer">
        <button id="apiKeyPrimaryBtn" class="modal-ok">Save</button>
        <button id="apiKeyCancelBtn" class="modal-ok">Cancel</button>
      </div>
    </div>
  </div>

  <!-- PIN Change overlay (opened from File ‚Üí PIN Change‚Ä¶) -->
  <div id="pinChangeOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="pinChangeTitle">
    <div class="modal-content modal-sm" role="document">
      <div class="modal-header">
        <h2 id="pinChangeTitle">PIN Change</h2>
        <button id="pinChangeCloseBtn" class="modal-close" aria-label="Close pin change">√ó</button>
      </div>

      <div class="modal-body">
        <p id="pinChangeIntro" class="modal-hint">
          Enter your current PIN and choose a new 6-digit PIN. Your saved keys will be re-encrypted locally.
        </p>

        <label id="pinChangeOldPinLabel">Old PIN (6 digits)</label>
        <div id="pinChangeOldPinBoxes" class="pin-boxes" role="group" aria-labelledby="pinChangeOldPinLabel">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Old PIN digit 1" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Old PIN digit 2" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Old PIN digit 3" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Old PIN digit 4" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Old PIN digit 5" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Old PIN digit 6" autocomplete="one-time-code">
        </div>
        <!-- hidden aggregator (JS keeps this in sync with the 6 boxes) -->
        <input type="hidden" id="pinChangeOldPin" inputmode="numeric" maxlength="6" autocomplete="off">

        <label id="pinChangeNewPinLabel" style="margin-top: 10px;">New PIN (6 digits)</label>
        <div id="pinChangeNewPinBoxes" class="pin-boxes" role="group" aria-labelledby="pinChangeNewPinLabel">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="New PIN digit 1" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="New PIN digit 2" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="New PIN digit 3" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="New PIN digit 4" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="New PIN digit 5" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="New PIN digit 6" autocomplete="one-time-code">
        </div>
        <!-- hidden aggregator -->
        <input type="hidden" id="pinChangeNewPin" inputmode="numeric" maxlength="6" autocomplete="off">

        <label id="pinChangeConfirmPinLabel" style="margin-top: 10px;">Confirm new PIN</label>
        <div id="pinChangeConfirmPinBoxes" class="pin-boxes" role="group" aria-labelledby="pinChangeConfirmPinLabel">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Confirm PIN digit 1" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Confirm PIN digit 2" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Confirm PIN digit 3" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Confirm PIN digit 4" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Confirm PIN digit 5" autocomplete="one-time-code">
          <input class="pin-box" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Confirm PIN digit 6" autocomplete="one-time-code">
        </div>
        <!-- hidden aggregator -->
        <input type="hidden" id="pinChangeConfirmPin" inputmode="numeric" maxlength="6" autocomplete="off">

         <div id="pinChangeHint" class="modal-hint"></div>
       </div>

       <div class="modal-footer">
         <button id="pinChangeApplyBtn" class="modal-ok" type="button">Change PIN</button>
         <button id="pinChangeCancelBtn" class="modal-ok" type="button">Cancel</button>
       </div>
     </div>
   </div>

  <!-- Clean and Reset overlay (opened from File ‚Üí Clean and Reset‚Ä¶) -->
  <div id="cleanResetOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="cleanResetTitle">
    <div class="modal-content modal-sm" role="document">
      <div class="modal-header">
        <h2 id="cleanResetTitle">Clean and Reset</h2>
        <button id="cleanResetCloseBtn" class="modal-close" aria-label="Close clean reset">√ó</button>
      </div>

      <div class="modal-body">
        <p id="cleanResetBody" class="modal-hint">
          This will remove all local app data (API keys, history, prompts, tabs, and settings).
        </p>
        <div id="cleanResetHint" class="modal-hint"></div>
      </div>

      <div class="modal-footer">
        <button id="cleanResetConfirmBtn" class="modal-ok" type="button">Yes, reset everything</button>
        <button id="cleanResetCancelBtn" class="modal-ok" type="button">Cancel</button>
      </div>
    </div>
  </div>

<!-- Tab Rename overlay -->
<div id="tabRenameOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="tabRenameTitle">
  <div class="modal-content modal-sm" role="document">
    <div class="modal-header">
      <h2 id="tabRenameTitle">Rename tab</h2>
      <button id="tabRenameCloseBtn" class="modal-close" aria-label="Close rename dialog">√ó</button>
    </div>

    <div class="modal-body">
      <label for="tabRenameInput" id="tabRenameLabel">Tab name</label>
      <input type="text" id="tabRenameInput" placeholder="e.g. auth.js patch" autocomplete="off">
      <div class="modal-hint" id="tabRenameHint">Press Enter to save</div>
    </div>

    <div class="modal-footer">
      <button id="tabRenameSaveBtn" class="modal-ok">Save</button>
      <button id="tabRenameCancelBtn" class="modal-ok">Cancel</button>
    </div>
  </div>
</div>

  <!-- Tab Close confirmation overlay -->
  <div id="tabCloseOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="tabCloseTitle">
    <div class="modal-content modal-sm" role="document">
      <div class="modal-header">
        <h2 id="tabCloseTitle">Close tab?</h2>
        <button id="tabCloseCloseBtn" class="modal-close" aria-label="Close close-tab dialog">√ó</button>
      </div>
 
      <div class="modal-body">
        <p id="tabCloseBody">
          Close <b id="tabCloseName">this tab</b>? Any unsaved input in this tab will be lost.
        </p>
      </div>
 
      <div class="modal-footer">
        <button id="tabCloseConfirmBtn" class="modal-ok">Close tab</button>
        <button id="tabCloseCancelBtn" class="modal-ok">Cancel</button>
      </div>
    </div>
  </div>
  <!-- System Prompt overlay (select / create / edit / save) -->
  <div id="sysPromptOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="sysPromptTitle">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="sysPromptTitle">System Prompt</h2>
        <button id="sysPromptCloseBtn" class="modal-close" aria-label="Close system prompt dialog">√ó</button>
      </div>

      <div class="modal-body">
        <div class="sys-prompt-layout">
          <div class="sys-prompt-list">
            <div class="sys-prompt-list-header">
              <div class="sys-prompt-list-title" id="sysPromptSavedTitle">Saved prompts</div>
              <div class="sys-prompt-list-actions">
                <button id="sysPromptNewBtn" class="modal-ok" type="button">New</button>
              </div>
            </div>

            <div id="sysPromptList" class="sys-prompt-items" role="listbox" aria-label="System prompts"></div>
            <div id="sysPromptListHint" class="modal-hint"></div>
          </div>

          <div class="sys-prompt-editor">
            <label for="sysPromptNameInput" id="sysPromptNameLabel">Prompt name</label>
            <input id="sysPromptNameInput" type="text" placeholder="e.g. Strict patcher" autocomplete="off">

            <label for="sysPromptText" id="sysPromptTextLabel">System prompt</label>
            <textarea id="sysPromptText" rows="12"></textarea>

            <div id="sysPromptHint" class="modal-hint"></div>
          </div>
        </div>
      </div>

      <div class="modal-footer sys-prompt-footer">
        <div class="sys-prompt-footer-left">
          <button id="sysPromptDuplicateBtn" class="modal-ok" type="button">Duplicate</button>
          <button id="sysPromptDeleteBtn" class="modal-ok" type="button">Delete</button>
        </div>
        <div class="sys-prompt-footer-right">
          <button id="sysPromptSaveBtn" class="modal-ok" type="button">Save</button>
          <button id="sysPromptUseBtn" class="modal-ok" type="button">Use in this tab</button>
          <button id="sysPromptCancelBtn" class="modal-ok" type="button">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- History overlay (opened from View ‚Üí History‚Ä¶) -->
  <div id="historyOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="historyTitle">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="historyTitle">History</h2>
        <button id="historyCloseBtn" class="modal-close" aria-label="Close history">√ó</button>
      </div>

      <div class="modal-body">
        <div class="history-toolbar">
          <div id="historyHint" class="history-hint"></div>
          <button id="historyClearBtn" class="modal-ok" type="button" title="Clear history">Clear</button>
        </div>

        <div id="historyList" class="history-list" role="list" aria-label="History items"></div>

        <div class="history-pagination" aria-label="History pagination">
          <button id="historyPrevBtn" class="modal-ok" type="button">Prev</button>
          <div id="historyPageLabel" class="history-page"></div>
          <button id="historyNextBtn" class="modal-ok" type="button">Next</button>
        </div>
      </div>

      <div class="modal-footer">
        <div style="display: flex; width: 100%; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button id="historyImportBtn" class="modal-ok" type="button">Import History</button>
            <button id="historyExportBtn" class="modal-ok" type="button">Export History</button>
            <input type="file" id="historyImportFile" class="hidden" accept=".zip,application/zip">
          </div>
          <button id="historyOkBtn" class="modal-ok" type="button">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Language overlay (opened from View ‚Üí Language‚Ä¶) -->
  <div id="languageOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="languageTitle">
    <div class="modal-content modal-sm" role="document">
      <div class="modal-header">
        <h2 id="languageTitle">Language</h2>
        <button id="languageCloseBtn" class="modal-close" aria-label="Close language">√ó</button>
      </div>
      <div class="modal-body">
        <div id="languageIntro" class="modal-hint">Choose a language. The app will reload.</div>
      </div>
      <div class="modal-footer" id="languageButtons" style="flex-wrap: wrap; gap: 8px;"></div>
    </div>
  </div>

  <!-- Confirm Patch Application overlay (shown after clicking Apply Patch) -->
  <div id="confirmApplyOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmApplyTitle">
    <div class="modal-content modal-sm" role="document">
      <div class="modal-header">
        <h2 id="confirmApplyTitle">Confirm Patch Application</h2>
        <button id="confirmApplyCloseBtn" class="modal-close" aria-label="Close confirmation">√ó</button>
      </div>
      <div class="modal-body">
        <p id="confirmApplyBody">Confirm application of the patch using model ?</p>
      </div>
      <div class="modal-footer">
        <button id="confirmApplyOkBtn" class="modal-ok" type="button">OK</button>
        <button id="confirmApplyCancelBtn" class="modal-ok" type="button">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Version Update overlay (shown on startup if a newer GitHub Release exists) -->
  <div id="versionOverlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="versionTitle">
    <div class="modal-content modal-update" role="document">
      <div class="modal-header">
        <h2 id="versionTitle">Update available</h2>
        <button id="versionCloseBtn" class="modal-close" aria-label="Close update">√ó</button>
      </div>

      <div class="modal-body">
        <p id="versionIntro" class="modal-hint">A newer version is available.</p>

        <div class="version-meta" aria-label="Version information">
          <div class="version-row">
            <div class="version-label" id="versionCurrentLabel">Current</div>
            <div class="version-value" id="versionCurrentValue">‚Äî</div>
          </div>
          <div class="version-row">
            <div class="version-label" id="versionLatestLabel">Latest</div>
            <div class="version-value" id="versionLatestValue">‚Äî</div>
          </div>
        </div>

        <div id="versionNotesWrap" class="version-notes hidden">
          <div class="version-notes-title" id="versionNotesTitle">What's new</div>
          <pre id="versionNotes" class="version-notes-text"></pre>
        </div>

        <div id="versionHint" class="modal-hint"></div>
      </div>

      <div class="modal-footer">
        <button id="versionDownloadBtn" class="modal-ok" type="button">Download</button>
        <button id="versionLaterBtn" class="modal-ok" type="button">Later</button>
      </div>
    </div>
  </div>

  <script src="bootstrap.js"></script>
</body>
</html>